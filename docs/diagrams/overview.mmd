graph TD
    subgraph User_Layer["User Layer"]
        CLI["CLI\nra search / ra get"]
        API["API Layer\n(Phase 5 — FastAPI)"]
    end

    subgraph Agent_Layer["Agent Layer"]
        RA["ResearchAgent\nagents/research_agent.py\nLangChain ReAct Loop"]
        TOOLS["Tool Definitions\ntools/retrieval_tools.py\nsearch · get · citations"]
    end

    subgraph Retrieval_Layer["Retrieval Layer"]
        UR["UnifiedRetriever\nretrieval/unified.py\nDedup · Normalize · Route"]
        S2["SemanticScholarClient\nretrieval/semantic_scholar.py\nMetadata · Citations"]
        AX["ArxivClient\nretrieval/arxiv.py\nFull-text · PDF · XML"]
    end

    subgraph Storage_Layer["Storage Layer (Phase 4)"]
        CHROMA["Vector Store — Chroma"]
        CACHE["Cache Layer"]
    end

    subgraph External["External APIs"]
        S2API["Semantic Scholar API"]
        AXAPI["arXiv API"]
        LLM["OpenAI LLM\nGPT-4o-mini / GPT-4o"]
    end

    CLI --> UR
    API -.-> RA
    RA --> TOOLS
    TOOLS --> UR
    TOOLS --> S2
    UR --> S2
    UR --> AX
    S2 --> S2API
    AX --> AXAPI
    RA --> LLM
    UR -.-> CHROMA
    UR -.-> CACHE

    classDef done fill:#d4edda,stroke:#28a745,color:#000
    classDef inprogress fill:#fff3cd,stroke:#ffc107,color:#000
    classDef planned fill:#f8d7da,stroke:#dc3545,color:#000

    class CLI,UR,S2,AX done
    class RA,TOOLS inprogress
    class API,CHROMA,CACHE planned
